
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    div.panel-body {
        overflow: scroll;
        background: url('http://subtlepatterns.com/patterns/geometry2.png');
    }
    /* Styling for message bubbles */
    #discussion p {
        padding: 10px;
        border-radius: 10px;
        margin: 5px 0;
        font-size: 16px;
        max-width:auto;
    }

    /* Style for the chat panel background */
    #chat {
        background: #f0f0f0; /* Light gray background */
        border-radius: 10px;
        padding: 10px;
        overflow-y: scroll;
    }

    /* Style the input field and send button */
    #message {
        width: 70%;
        padding: 5px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    #sendmessage {
        background-color: #007BFF; /* Blue send button */
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
    }

    /* Style user avatars */
    img[title="NhanVien"], img[title="KhachHang"] {
        width: 30px;
        height: 30px;
    
        margin: 0 5px;
    }

</style>

<div class="chat-panel panel panel-default">
    <!-- /.panel-heading -->
    <h2 style=" margin: auto; width: 50%;margin-top:20px;">Nhắn Tin</h2>
    <div class="panel-body" id="chat" style="height: 250px; margin: auto; width: 50%; border: 3px solid gray; padding: 10px;margin-bottom:5px;">
        <input type="hidden" id="displayname" />
        <p id="discussion"></p>
    </div>
    <!-- /.panel-body -->
    <div class="panel-footer" style=" margin: auto; width: 50%; margin-bottom: 20px;">
        <div class="input-group">
            <input id="message" type="text" name="message" class="form-control input-sm" placeholder="Nhập Tin Nhắn..." />
            <span class="input-group-btn" style="margin-left:5px;">
                <input type="button" class="btn btn-warning btn-sm" id="sendmessage" value="Send">

            </span>
        </div>
    </div>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                if (message == "") {
                    alert("Bạn chưa nhập tin nhắn");
                }
                else if (message != null ) {
                    if (name == "Admin") {
                        // Add the message to the page.
                        $('#discussion').append('<p style="color:green;    background-color:white; text-align:left;"><strong><img = src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_7.png" title="NhanVien">'
                            + ' </strong> ' + htmlEncode(message) + '</p>');
                    }
                    else if (name != "Admin") {
                        // Add the message to the page.
                        $('#discussion').append('<p style="color:blue;text-align:right;background-color:white;">' +
                            '<strong>' + htmlEncode(message) + '</strong>' +
                            ' <img src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_71.png" title="KhachHang">' +
                            '</p>');
                    }
                }
        
            };

             var userRole = "@Session["RoleUser"]";
            var defaultName = "@Session["DisplayName"]";
            if (userRole != null) {
                // Get the user name and store it to prepend to messages.
                $('#displayname').val(defaultName);
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });
            }
            else {
                // Get the user name and store it to prepend to messages.
          /*      $('#displayname').val(prompt('Enter your name:', ''));*/
                $('#displayname').val(prompt('Enter your name:', ''));
                // Set initial focus to message input box.
                $('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });
            }

        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>

}